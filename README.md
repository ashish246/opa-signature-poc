# opa-sginature-poc
POC of the new OPA .signature file for OPA bundles.

This repository contains:
1. Sample policy and data files under the directory `/db`. `/db/uam2` is the one used in the sample codes for testing
2. `/src` directory contains the Java implementation pf signing bundles using [NIMBUS JOSE + JWT](https://bitbucket.org/connect2id/nimbus-jose-jwt/wiki/Home) library. Currently this library support only compact serialisation of JWS objects
3. `/pkg` directory contains the GO implementation of signing bundles using [GO-JOSE](https://github.com/square/go-jose) library. This library supports both compact and non-compact serialisation of JWS objects

## Runing the POC

- Run Go code using below command
```bash
go run pkg/go-jose/OpaSignature.go
```


- Run Java code using below command
```bash
./gradlew run
```

- Executing `GO` command generates 3 files `db/uam2/.signature-compact-RSA`, `db/uam2/.signature-full-RSA` and `db/uam2/.signature-compact-HMAC` which contains the serialised JWS object for compact and non-compact serialisation respectively for RSA and HMAC crypto algos
- Executing `Gradle` command for Java generates 2 files `db/uam2/.signature-compact-RSA` and `db/uam2/.signature-compact-HMAC` which contains the serialised JWS object for compact serialisation as none of the Java libraries support non-compact serialisation yet (or I couldn't find one such yet)
- Running either of the commands first looks at the signature files and verifies the token/signature if the file has any content (generated by either of the previous command) and then generates new token/signature and updates the file with it

- Running either `GO` or `Java` utility produces 3 signature files under the `db/uam2` directory:
    1. `.signature-compact-RSA`: This file contains the signature/JWT token generated using asymmetric RSA keys and using compact serialisation of JWS object
    2. `.signature-full-RSA`: This file contains the signature/JWT token generated using asymmetric RSA keys and using the non-compact/JSON serialisation of JWS object. This is only generated and validated by `GO` utility
    3. `.signature-compact-HMAC`: This file contains the signature/JWT token generated using symmetric keys (using secret key) i.e. HMAC algo and using compact serialisation of JWS object